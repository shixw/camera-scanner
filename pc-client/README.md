# 手机摄像头扫描仪 - PC端

这是手机摄像头扫描仪的PC端应用，基于Electron构建。

## 新架构说明

### 架构变更
- **分离部署**: PC端和手机端现在分别部署，不再依赖同一个HTTP服务器
- **HTTPS支持**: 手机端需要部署到支持HTTPS的服务上（如GitHub Pages、Netlify等）
- **WebSocket通信**: PC端和手机端通过WebSocket协议进行通信
- **参数化连接**: 二维码包含手机端URL和WebSocket连接参数

### 连接流程
1. PC端启动后显示本机IP和WebSocket端口
2. 用户配置手机端部署的HTTPS地址
3. PC端生成包含连接参数的二维码
4. 手机扫描二维码或手动输入连接信息
5. 建立WebSocket连接，开始视频传输

## 安装和运行

### 环境要求
- Node.js 16+
- npm 或 yarn

### 安装依赖
```bash
cd pc-client
npm install
```

### 启动应用
```bash
npm start
```

### 打包应用
```bash
npm run package
```

## 配置说明

### 手机端URL配置
1. 首先部署手机端到HTTPS服务（参考mobile-client文件夹的README）
2. 在PC端界面的"配置设置"区域输入手机端的HTTPS地址
3. 点击"更新"按钮保存配置
4. 系统会自动生成新的二维码

### 连接信息
- **本机IP**: 自动检测的局域网IP地址
- **WebSocket端口**: 默认3002，如果被占用会自动选择其他端口
- **连接数**: 当前连接的手机设备数量

## 使用说明

### 基本操作
1. **配置手机端URL**: 在配置区域输入已部署的手机端HTTPS地址
2. **连接手机**: 
   - 方式1：手机扫描生成的二维码
   - 方式2：手机端手动输入WebSocket连接信息
3. **视频传输**: 连接成功后，手机摄像头画面会显示在PC端
4. **截图**: 点击"截图"按钮保存当前画面
5. **历史记录**: 查看和复制之前的截图

### 界面说明
- **连接状态**: 顶部显示当前连接状态和设备数量
- **视频区域**: 显示手机摄像头实时画面
- **配置区域**: 设置手机端URL和查看连接信息
- **二维码区域**: 生成供手机扫描的连接二维码
- **控制区域**: 分辨率设置、截图、关闭应用等功能
- **历史区域**: 显示截图历史记录

### 注意事项
1. **网络要求**: PC端和手机端需要在同一局域网内
2. **防火墙**: 确保WebSocket端口（默认3002）未被防火墙阻止
3. **HTTPS要求**: 手机端必须使用HTTPS协议才能访问摄像头
4. **浏览器兼容**: 手机端需要支持WebRTC的现代浏览器

## 故障排除

### 常见问题
1. **无法生成二维码**
   - 检查手机端URL是否正确配置
   - 确认HTTP服务器是否正常启动

2. **手机无法连接**
   - 确认PC端和手机在同一网络
   - 检查防火墙设置
   - 验证WebSocket端口是否被占用

3. **摄像头无法访问**
   - 确认手机端使用HTTPS协议
   - 检查浏览器权限设置
   - 尝试刷新页面重新授权

4. **视频传输中断**
   - 检查网络连接稳定性
   - 尝试重新连接
   - 降低视频分辨率

## 技术架构

### 核心技术
- **Electron**: 跨平台桌面应用框架
- **WebSocket**: 实时双向通信
- **Express**: HTTP服务器（用于二维码生成）
- **QRCode**: 二维码生成库

### 文件结构
```
pc-client/
├── main.js              # 主进程
├── preload.js           # 预加载脚本
├── package.json         # 项目配置
├── renderer/            # 渲染进程
│   ├── index.html       # 主界面
│   ├── renderer.js      # 渲染逻辑
│   └── style.css        # 样式文件
└── README.md           # 说明文档
```

## 开发说明

### 调试模式
应用启动时会自动打开开发者工具，方便调试。

### 日志输出
- 主进程日志：在终端查看
- 渲染进程日志：在开发者工具Console查看

### 端口配置
- HTTP服务器：默认3001，自动检测可用端口
- WebSocket服务器：默认3002，自动检测可用端口